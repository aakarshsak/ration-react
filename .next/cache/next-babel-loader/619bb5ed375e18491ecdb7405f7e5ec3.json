{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport { Card, Button } from 'semantic-ui-react';\nimport factory from '../ethereum/factory';\nimport Layout from '../components/layout';\nimport { Link } from '../routes';\nimport get from '../localmodules/express_get';\nimport validate from '../localmodules/token_validate';\nimport Shop from '../ethereum/shop';\nimport '../localmodules/location/location_dropdown'; // import jsonArray from '../localmodules/data_initialization';\n\nvar App = /*#__PURE__*/function (_Component) {\n  _inherits(App, _Component);\n\n  function App() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, App);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(App)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      user: null\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"getUserDetails\", function _callee(token) {\n      var headers, _ref, data, status;\n\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              headers = {\n                'Content-Type': 'application/json',\n                'x-auth-token': token\n              };\n\n              if (!_this.props.loggedIn) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.next = 4;\n              return _regeneratorRuntime.awrap(get('/user/login/me', headers));\n\n            case 4:\n              _ref = _context.sent;\n              data = _ref.data;\n              status = _ref.status;\n\n              _this.setState({\n                user: data\n              });\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"renderShops\", function () {\n      var items = _this.props.shopList.map(function (item, index) {\n        return __jsx(Card, null, __jsx(Card.Content, {\n          header: item.details[6].toUpperCase()\n        }), __jsx(Card.Content, {\n          description: __jsx(Link, {\n            route: \"/\".concat(validate(_this.props.headerToken).headerToken, \"/shops/\").concat(item.address)\n          }, __jsx(\"a\", null, \"View Shops\"))\n        }), __jsx(Card.Content, {\n          meta: item.details[8].substring(0, item.details[8].toLowerCase().indexOf(\"Chiknayakanhalli\".toLowerCase()))\n        }));\n      });\n\n      return __jsx(Card.Group, {\n        items: items,\n        itemsPerRow: 2\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onClick\", function _callee2(event) {\n      var headers, _ref2, data, status;\n\n      return _regeneratorRuntime.async(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              event.preventDefault();\n              headers = {\n                'Content-Type': 'application/json',\n                'x-auth-token': _this.props.headerToken\n              };\n              _context2.next = 4;\n              return _regeneratorRuntime.awrap(get('/user/login/me', headers));\n\n            case 4:\n              _ref2 = _context2.sent;\n              data = _ref2.data;\n              status = _ref2.status;\n              console.log(data);\n              console.log(status);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      return __jsx(Layout, {\n        loggedIn: this.props.loggedIn,\n        headerToken: this.props.headerToken\n      }, __jsx(\"div\", null, this.renderShops(), __jsx(Button, {\n        onClick: this.onClick,\n        content: \"Create Shops\",\n        icon: \"add circle\",\n        primary: true\n      })));\n    }\n  }], [{\n    key: \"getInitialProps\",\n    value: function getInitialProps(props) {\n      var shops, shopList, i, s, details, obj, _validate, loggedIn, headerToken;\n\n      return _regeneratorRuntime.async(function getInitialProps$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return _regeneratorRuntime.awrap(factory.methods.getDeployedShops().call());\n\n            case 2:\n              shops = _context3.sent;\n              shopList = [];\n              i = 0;\n\n            case 5:\n              if (!(i < shops.length)) {\n                _context3.next = 15;\n                break;\n              }\n\n              s = Shop(shops[i]);\n              _context3.next = 9;\n              return _regeneratorRuntime.awrap(s.methods.getDetails().call());\n\n            case 9:\n              details = _context3.sent;\n              //const blockName = await s.methods.blockName().call();\n              obj = {\n                details: details,\n                address: shops[i] //blockName\n\n              };\n              shopList.push(obj);\n\n            case 12:\n              i++;\n              _context3.next = 5;\n              break;\n\n            case 15:\n              //console.log(shopList);\n              _validate = validate(props.query.headerToken), loggedIn = _validate.loggedIn, headerToken = _validate.headerToken;\n              return _context3.abrupt(\"return\", {\n                shops: shops,\n                headerToken: headerToken,\n                loggedIn: loggedIn,\n                shopList: shopList\n              });\n\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      });\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/home/zoro/Documents/Programming/JS/ration/ration-react/pages/index.js"],"names":["React","Component","Card","Button","factory","Layout","Link","get","validate","Shop","App","user","token","headers","props","loggedIn","data","status","setState","items","shopList","map","item","index","details","toUpperCase","headerToken","address","substring","toLowerCase","indexOf","event","preventDefault","console","log","renderShops","onClick","methods","getDeployedShops","call","shops","i","length","s","getDetails","obj","push","query"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport { Card, Button } from 'semantic-ui-react';\nimport factory from '../ethereum/factory';\nimport Layout from '../components/layout';\nimport { Link } from '../routes';\nimport get from '../localmodules/express_get';\nimport validate from '../localmodules/token_validate';\nimport Shop from '../ethereum/shop';\nimport {  } from '../localmodules/location/location_dropdown';\n// import jsonArray from '../localmodules/data_initialization';\n\nclass App extends Component {\n    \n    state = { user : null };\n    static async getInitialProps(props) {\n\n        const shops = await factory.methods.getDeployedShops().call();\n        let shopList = [];\n        for(let i=0;i<shops.length;i++){\n            const s = Shop(shops[i]);\n            const details = await s.methods.getDetails().call();\n            //const blockName = await s.methods.blockName().call();\n            const obj = {\n                details,\n                address : shops[i],\n                //blockName\n            };\n            shopList.push(obj);\n        }\n        //console.log(shopList);\n        const { loggedIn, headerToken } = validate(props.query.headerToken);\n        return { shops, headerToken, loggedIn, shopList };\n    }\n\n    getUserDetails = async (token) => {\n        const headers = { 'Content-Type':'application/json', 'x-auth-token' : token};\n        if(this.props.loggedIn){\n            const {data, status} = await get('/user/login/me', headers);\n            this.setState({user : data});\n        }\n    }\n\n    renderShops = () => {\n        const items = this.props.shopList.map((item, index) => {\n            return (\n                <Card>\n                    <Card.Content header = {item.details[6].toUpperCase()}/>\n                    <Card.Content description = {<Link route={`/${validate(this.props.headerToken).headerToken}/shops/${item.address}`}><a>View Shops</a></Link>} />\n                    <Card.Content meta = {item.details[8].substring(0,item.details[8].toLowerCase().indexOf(\"Chiknayakanhalli\".toLowerCase()))} />\n                </Card>\n            );\n        });\n\n        return <Card.Group items={items} itemsPerRow={2}/>;\n    }\n\n    onClick = async (event) => {\n        event.preventDefault();\n        const headers = { \n                'Content-Type':'application/json',\n                'x-auth-token' : this.props.headerToken\n        };\n\n        const {data, status} = await get('/user/login/me', headers);\n        console.log(data);\n        console.log(status);\n    }\n\n    render() {\n        return (\n            <Layout loggedIn={this.props.loggedIn} headerToken={this.props.headerToken}>\n                <div>\n                    {this.renderShops()}\n                    <Button\n                        onClick={this.onClick}\n                        content=\"Create Shops\"\n                        icon=\"add circle\"\n                        primary\n                    />\n                </div>\n            </Layout>\n        );\n\n    }\n\n}\n\nexport default App;\n\n\n"]},"metadata":{},"sourceType":"module"}